<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Band Excitation data procesing &mdash; BGlib 0.0.4 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/documentation_options.js?v=8c5712d9"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Band Excitation data procesing using pycroscopy" href="BE_Processing_cKPFM.html" />
    <link rel="prev" title="Band Excitation" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            BGlib
          </a>
              <div class="version">
                0.0.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">BGlib</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">BGlib</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/BGlib.html">BGlib</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Band Excitation</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Band Excitation data procesing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Suhas-Somnath,-Chris-R.-Smith,-Stephen-Jesse">Suhas Somnath, Chris R. Smith, Stephen Jesse</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Reference:">Reference:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Jupyter-Notebooks:">Jupyter Notebooks:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#H5-files:">H5 files:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#You-can-load-either-of-the-following:">You can load either of the following:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html">Band Excitation data procesing using pycroscopy</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#cKPFM-analysis">cKPFM analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Configure-the-notebook">Configure the notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Set-some-basic-parameters-for-computation">Set some basic parameters for computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Make-the-data-pycroscopy-compatible">Make the data pycroscopy compatible</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Get-some-basic-parameters-from-the-H5-file">Get some basic parameters from the H5 file</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Visualize-the-raw-data">Visualize the raw data</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Fit-the-Band-Excitation-(BE)-spectra">Fit the Band Excitation (BE) spectra</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Remove-phase-offset">Remove phase offset</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Display-cKPFM-data">Display cKPFM data</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Display-averaged-cKPFM-data">Display averaged cKPFM data</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Export-response-after-all-write-steps-for-all-pixels">Export response after all write steps for all pixels</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Display-averaged-response-at-0-V-read-voltage">Display averaged response at 0 V read voltage</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Display-response,-amplitude-and-phase-data-at-0-V-read-voltage-for-a-single-pixel">Display response, amplitude and phase data at 0 V read voltage for a single pixel</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Display-on-field-loops-for-all-read-steps">Display on-field loops for all read steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Calculate-the-jCPD">Calculate the jCPD</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Display-jCPD-data">Display jCPD data</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Display-jCPD-and-fitting-parameters">Display jCPD and fitting parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#jCPD-plots">jCPD plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#PCA-analysis">PCA analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Visualize-the-SHO-results-of-BEline,-BEPS-and-FORC-data">Visualize the SHO results of BEline, BEPS and FORC data</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Fit-loops-to-a-function">Fit loops to a function</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Prepare-datasets-for-visualization">Prepare datasets for visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Visualize-Loop-fits">Visualize Loop fits</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Processing_cKPFM.html#Save-and-close">Save and close</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Relaxation%20Processing.html">Band Excitation Relaxation Spectroscopy Data Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Relaxation%20Processing.html#Configure-the-notebook">Configure the notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Relaxation%20Processing.html#Set-some-basic-parameters-for-computation">Set some basic parameters for computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Relaxation%20Processing.html#Make-the-data-pycroscopy-compatible">Make the data pycroscopy compatible</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Relaxation%20Processing.html#Get-some-basic-parameters-from-the-H5-file">Get some basic parameters from the H5 file</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Relaxation%20Processing.html#Perform-SHO-fits-to-data-to-extract-PFM-response">Perform SHO fits to data to extract PFM response</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Relaxation%20Processing.html#Perform-functional-fits-to-PFM-relaxation-data">Perform functional fits to PFM relaxation data</a></li>
<li class="toctree-l2"><a class="reference internal" href="BE_Relaxation%20Processing.html#Visualize-the-data">Visualize the data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../gmode/index.html">General Mode</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">BGlib</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Band Excitation</a></li>
      <li class="breadcrumb-item active">Band Excitation data procesing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/be/BE_Processing.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Band-Excitation-data-procesing">
<h1>Band Excitation data procesing<a class="headerlink" href="#Band-Excitation-data-procesing" title="Link to this heading">¶</a></h1>
<section id="Suhas-Somnath,-Chris-R.-Smith,-Stephen-Jesse">
<h2>Suhas Somnath, Chris R. Smith, Stephen Jesse<a class="headerlink" href="#Suhas-Somnath,-Chris-R.-Smith,-Stephen-Jesse" title="Link to this heading">¶</a></h2>
<p>The Center for Nanophase Materials Science and The Institute for Functional Imaging for Materials Oak Ridge National Laboratory 9/2/2020</p>
</section>
<section id="Reference:">
<h2>Reference:<a class="headerlink" href="#Reference:" title="Link to this heading">¶</a></h2>
<p>This Jupyter notebook uses <a class="reference external" href="https://pycroscopy.github.io/pycroscopy/about.html">pycroscopy</a> to analyze Band Excitation data. We request you to reference the <a class="reference external" href="https://arxiv.org/abs/1903.09515">Arxiv paper</a> titled “<em>USID and Pycroscopy - Open frameworks for storing and analyzing spectroscopic and imaging data</em>” in your publications.</p>
<section id="Jupyter-Notebooks:">
<h3>Jupyter Notebooks:<a class="headerlink" href="#Jupyter-Notebooks:" title="Link to this heading">¶</a></h3>
<p>This is a Jupyter Notebook - it contains text and executable code <code class="docutils literal notranslate"><span class="pre">cells</span></code>. To learn more about how to use it, please see <a class="reference external" href="https://www.youtube.com/watch?v=jZ952vChhuI">this video</a>. Please see the image below for some basic tips on using this notebook.</p>
<p>If you have any questions or need help running this notebook, please get in touch with your host if you are a users at the Center for Nanophase Materials Science (CNMS) or our <a class="reference external" href="https://groups.google.com/forum/#!forum/pycroscopy">google group</a>.</p>
<p><img alt="notebook_rules.png" src="https://raw.githubusercontent.com/pycroscopy/pycroscopy/master/jupyter_notebooks/notebook_rules.png" /></p>
<p>Image courtesy of Jean Bilheux from the <a class="reference external" href="https://github.com/neutronimaging/python_notebooks">neutron imaging</a> GitHub repository.</p>
<section id="Configure-the-notebook">
<h4>Configure the notebook<a class="headerlink" href="#Configure-the-notebook" title="Link to this heading">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make sure needed packages are installed and up-to-date</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="o">!</span>conda<span class="w"> </span>install<span class="w"> </span>--yes<span class="w"> </span>--prefix<span class="w"> </span><span class="o">{</span>sys.prefix<span class="o">}</span><span class="w"> </span>numpy<span class="w"> </span>scipy<span class="w"> </span>matplotlib<span class="w"> </span>scikit-learn<span class="w"> </span>Ipython<span class="w"> </span>ipywidgets<span class="w"> </span>h5py
<span class="o">!{</span>sys.executable<span class="o">}</span><span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>--no-deps<span class="w"> </span>BGlib<span class="w">  </span>#<span class="w"> </span>this<span class="w"> </span>will<span class="w"> </span>automatically<span class="w"> </span>install<span class="w"> </span>sidpy<span class="w"> </span>and<span class="w"> </span>pyUSID<span class="w"> </span>as<span class="w"> </span>well
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

DirectoryNotACondaEnvironmentError: The target directory exists, but it is not a conda environment.
Use &#39;conda create&#39; to convert the directory to a conda environment.
  target directory: /opt/hostedtoolcache/Python/3.9.17/x64


Requirement already satisfied: BGlib in /opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages (0.0.4)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ensure python 3 compatibility</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">absolute_import</span>

<span class="c1"># Import necessary libraries:</span>
<span class="c1"># General utilities:</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Computation:</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">h5py</span>

<span class="c1"># Visualization:</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="c1"># The engineering components supporting BGlib:</span>
<span class="kn">import</span> <span class="nn">sidpy</span>
<span class="kn">import</span> <span class="nn">pyUSID</span> <span class="k">as</span> <span class="nn">usid</span>
<span class="c1"># Finally, BGlib itself</span>
<span class="kn">from</span> <span class="nn">BGlib</span> <span class="kn">import</span> <span class="n">be</span> <span class="k">as</span> <span class="n">belib</span>

<span class="c1"># Make Notebook take up most of page width</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;style&gt;</span>
<span class="s2">    div#notebook-container    { width: 95%; }</span>
<span class="s2">    div#menubar-container     { width: 65%; }</span>
<span class="s2">    div#maintoolbar-container { width: 99%; }</span>
<span class="s2">&lt;/style&gt;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
    div#notebook-container    { width: 95%; }
    div#menubar-container     { width: 65%; }
    div#maintoolbar-container { width: 99%; }
</style></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up notebook to show plots within the notebook</span>
<span class="o">%</span><span class="k">matplotlib</span> notebook
</pre></div>
</div>
</div>
</section>
<section id="Set-some-basic-preferences">
<h4>Set some basic preferences<a class="headerlink" href="#Set-some-basic-preferences" title="Link to this heading">¶</a></h4>
<p>This notebook performs some functional fitting whose duration can be substantially decreased by using more memory and CPU cores. We have provided default values below but you may choose to change them if necessary. Setting <code class="docutils literal notranslate"><span class="pre">max_cores</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code> will allow usage of all but one CPU core for the computations.</p>
<p>By default, results of the functional fitting will be written back to the same HDF5 file. However, if you prefer to write results into different HDF5 files, please set the <code class="docutils literal notranslate"><span class="pre">results_to_new_file</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">True</span></code> instead. Users of the <a class="reference external" href="https://datafed.ornl.gov">DataFed</a> Scientific Data Management System may want to set this parameter to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_mem</span>         <span class="o">=</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">8</span>  <span class="c1"># Maximum memory to use, in Mbs. Default = 1024</span>
<span class="n">max_cores</span>       <span class="o">=</span> <span class="kc">None</span>    <span class="c1"># Number of logical cores to use in fitting.  None uses all but 2 available cores.</span>
<span class="n">results_to_new_file</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</section>
<section id="Make-the-data-USID-compatible">
<h4>Make the data USID compatible<a class="headerlink" href="#Make-the-data-USID-compatible" title="Link to this heading">¶</a></h4>
<p>Converting the raw data into a USID formatted hierarchical data format (HDF or .h5) file gives you access to the fast fitting algorithms and powerful analysis functions within the broader pycroscopy ecosystem</p>
</section>
</section>
<section id="H5-files:">
<h3>H5 files:<a class="headerlink" href="#H5-files:" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>are like smart containers that can store matrices with data, folders to organize these datasets, images, metadata like experimental parameters, links or shortcuts to datasets, etc.</p></li>
<li><p>are readily compatible with high-performance computing facilities</p></li>
<li><p>scale very efficiently from few kilobytes to several terabytes</p></li>
<li><p>can be read and modified using any language including Python, Matlab, C/C++, Java, Fortran, Igor Pro, etc.</p></li>
</ul>
</section>
<section id="You-can-load-either-of-the-following:">
<h3>You can load either of the following:<a class="headerlink" href="#You-can-load-either-of-the-following:" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Any .mat or .txt parameter file from the original experiment</p></li>
<li><p>A .h5 file generated from the raw data using BGlib - skips translation</p></li>
</ul>
<p>You can select desired file type by choosing the second option in the pull down menu on the bottom right of the file window</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_file_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/syz/Desktop/BEPS_NDF/Example_1/20170225_MoTe2_S3_F4_vdc_sweep_contact_0001/20170225_MoTe2_S3_F4_vdc_sweep_contact_parms_0001.txt&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">)</span>

<span class="k">if</span> <span class="n">input_file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.h5&#39;</span><span class="p">):</span>
    <span class="c1"># No translation here</span>
    <span class="n">h5_path</span> <span class="o">=</span> <span class="n">input_file_path</span>
    <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Set this to true to force patching of the datafile.</span>
    <span class="n">tl</span> <span class="o">=</span> <span class="n">belib</span><span class="o">.</span><span class="n">translators</span><span class="o">.</span><span class="n">LabViewH5Patcher</span><span class="p">()</span>
    <span class="n">tl</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">h5_path</span><span class="p">,</span> <span class="n">force_patch</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Set the data to be translated</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="n">input_file_path</span>

    <span class="p">(</span><span class="n">junk</span><span class="p">,</span> <span class="n">base_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>

    <span class="c1"># Check if the data is in the new or old format.  Initialize the correct translator for the format.</span>
    <span class="k">if</span> <span class="n">base_name</span> <span class="o">==</span> <span class="s1">&#39;newdataformat&#39;</span><span class="p">:</span>
        <span class="p">(</span><span class="n">junk</span><span class="p">,</span> <span class="n">base_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">junk</span><span class="p">)</span>
        <span class="n">translator</span> <span class="o">=</span> <span class="n">belib</span><span class="o">.</span><span class="n">translators</span><span class="o">.</span><span class="n">BEPSndfTranslator</span><span class="p">(</span><span class="n">max_mem_mb</span><span class="o">=</span><span class="n">max_mem</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">translator</span> <span class="o">=</span> <span class="n">belib</span><span class="o">.</span><span class="n">translators</span><span class="o">.</span><span class="n">BEodfTranslator</span><span class="p">(</span><span class="n">max_mem_mb</span><span class="o">=</span><span class="n">max_mem</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">base_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_d&#39;</span><span class="p">):</span>
        <span class="n">base_name</span> <span class="o">=</span> <span class="n">base_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1"># Translate the data</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">translator</span><span class="p">)</span>
    <span class="n">h5_path</span> <span class="o">=</span> <span class="n">translator</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">show_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_plots</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/sidpy/sid/translator.py:42: FutureWarning: Consider using sidpy.Reader instead of sidpy.Translator if possible and contribute your reader to ScopeReaders
  warn(&#39;Consider using sidpy.Reader instead of sidpy.Translator if &#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;BGlib.be.translators.be_odf.BEodfTranslator object at 0x7faa7d189dc0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[6], line 25</span>
<span class="ansi-green-intense-fg ansi-bold">     23</span> <span style="color: rgb(95,135,135)"># Translate the data</span>
<span class="ansi-green-intense-fg ansi-bold">     24</span> <span style="color: rgb(0,135,0)">print</span>(translator)
<span class="ansi-green-fg">---&gt; 25</span> h5_path <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">translator</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">translate</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data_path</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">show_plots</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">True</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">save_plots</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">False</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/BGlib/be/translators/be_odf.py:151</span>, in <span class="ansi-cyan-fg">BEodfTranslator.translate</span><span class="ansi-blue-fg">(self, file_path, show_plots, save_plots, do_histogram, verbose)</span>
<span class="ansi-green-intense-fg ansi-bold">    149</span> file_path <span style="color: rgb(98,98,98)">=</span> path<span style="color: rgb(98,98,98)">.</span>abspath(file_path)
<span class="ansi-green-intense-fg ansi-bold">    150</span> (folder_path, basename) <span style="color: rgb(98,98,98)">=</span> path<span style="color: rgb(98,98,98)">.</span>split(file_path)
<span class="ansi-green-fg">--&gt; 151</span> (basename, path_dict) <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_parse_file_path</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">file_path</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    153</span> h5_path <span style="color: rgb(98,98,98)">=</span> path<span style="color: rgb(98,98,98)">.</span>join(folder_path, basename <span style="color: rgb(98,98,98)">+</span> <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">.h5</span><span style="color: rgb(175,0,0)">&#39;</span>)
<span class="ansi-green-intense-fg ansi-bold">    154</span> tot_bins_multiplier <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(98,98,98)">1</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/BGlib/be/translators/be_odf.py:848</span>, in <span class="ansi-cyan-fg">BEodfTranslator._parse_file_path</span><span class="ansi-blue-fg">(data_filepath)</span>
<span class="ansi-green-intense-fg ansi-bold">    840</span> <span style="color: rgb(175,0,0)">&#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    841</span> <span style="color: rgb(175,0,0)">A single pair of real and imaginary files are / were generated for:</span>
<span class="ansi-green-intense-fg ansi-bold">    842</span> <span style="color: rgb(175,0,0)">    BE-Line and BEPS (compiled version only generated out-of-field or &#39;read&#39;)</span>
<span class="ansi-green-intense-fg ansi-bold">    843</span> <span style="color: rgb(175,0,0)">Two pairs of real and imaginary files were generated for later BEPS datasets</span>
<span class="ansi-green-intense-fg ansi-bold">    844</span> <span style="color: rgb(175,0,0)">    These have &#39;read&#39; and &#39;write&#39; prefixes to denote out or in field respectively</span>
<span class="ansi-green-intense-fg ansi-bold">    845</span> <span style="color: rgb(175,0,0)">&#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    846</span> path_dict <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">dict</span>()
<span class="ansi-green-fg">--&gt; 848</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> file_name <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span class="ansi-yellow-bg">listdir</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">folder_path</span><span class="ansi-yellow-bg">)</span>:
<span class="ansi-green-intense-fg ansi-bold">    849</span>     abs_path <span style="color: rgb(98,98,98)">=</span> path<span style="color: rgb(98,98,98)">.</span>join(folder_path, file_name)
<span class="ansi-green-intense-fg ansi-bold">    850</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> file_name<span style="color: rgb(98,98,98)">.</span>endswith(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">.txt</span><span style="color: rgb(175,0,0)">&#39;</span>) <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> file_name<span style="color: rgb(98,98,98)">.</span>find(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">parm</span><span style="color: rgb(175,0,0)">&#39;</span>) <span style="color: rgb(98,98,98)">&gt;</span> <span style="color: rgb(98,98,98)">0</span>:

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;/Users/syz/Desktop/BEPS_NDF/Example_1/20170225_MoTe2_S3_F4_vdc_sweep_contact_0001&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">folder_path</span><span class="p">,</span> <span class="n">h5_raw_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">h5_path</span><span class="p">)</span>
<span class="n">h5_file</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">h5_path</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Working on:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">h5_path</span><span class="p">)</span>

<span class="n">h5_main</span> <span class="o">=</span> <span class="n">usid</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">find_dataset</span><span class="p">(</span><span class="n">h5_file</span><span class="p">,</span> <span class="s1">&#39;Raw_Data&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[7], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> folder_path, h5_raw_file_name <span style="color: rgb(98,98,98)">=</span> os<span style="color: rgb(98,98,98)">.</span>path<span style="color: rgb(98,98,98)">.</span>split(<span class="ansi-yellow-bg">h5_path</span>)
<span class="ansi-green-intense-fg ansi-bold">      2</span> h5_file <span style="color: rgb(98,98,98)">=</span> h5py<span style="color: rgb(98,98,98)">.</span>File(h5_path, <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">r+</span><span style="color: rgb(175,0,0)">&#39;</span>)
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">Working on:</span><span class="ansi-bold" style="color: rgb(175,95,0)">\n</span><span style="color: rgb(175,0,0)">&#39;</span> <span style="color: rgb(98,98,98)">+</span> h5_path)

<span class="ansi-red-fg">NameError</span>: name &#39;h5_path&#39; is not defined
</pre></div></div>
</div>
<p>The file contents are stored in a tree structure, just like files on a conventional computer. The data is stored as a 2D matrix (position, spectroscopic value) regardless of the dimensionality of the data. Thus, the positions will be arranged as row0-col0, row0-col1…. row0-colN, row1-col0…. and the data for each position is stored as it was chronologically collected</p>
<p>The main dataset is always accompanied by four ancillary datasets that explain the position and spectroscopic value of any given element in the dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Datasets and datagroups within the file:</span><span class="se">\n</span><span class="s1">------------------------------------&#39;</span><span class="p">)</span>
<span class="n">sidpy</span><span class="o">.</span><span class="n">hdf</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">print_tree</span><span class="p">(</span><span class="n">h5_file</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The main dataset:</span><span class="se">\n</span><span class="s1">------------------------------------&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h5_main</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Metadata or attributes in the measurement datagroup</span><span class="se">\n</span><span class="s1">------------------------------------&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">sidpy</span><span class="o">.</span><span class="n">hdf</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">get_attributes</span><span class="p">(</span><span class="n">h5_main</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Datasets and datagroups within the file:
------------------------------------
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[8], line 2</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">Datasets and datagroups within the file:</span><span class="ansi-bold" style="color: rgb(175,95,0)">\n</span><span style="color: rgb(175,0,0)">------------------------------------</span><span style="color: rgb(175,0,0)">&#39;</span>)
<span class="ansi-green-fg">----&gt; 2</span> sidpy<span style="color: rgb(98,98,98)">.</span>hdf<span style="color: rgb(98,98,98)">.</span>hdf_utils<span style="color: rgb(98,98,98)">.</span>print_tree(<span class="ansi-yellow-bg">h5_file</span>)
<span class="ansi-green-intense-fg ansi-bold">      4</span> <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(175,0,0)">&#39;</span><span class="ansi-bold" style="color: rgb(175,95,0)">\n</span><span style="color: rgb(175,0,0)">The main dataset:</span><span class="ansi-bold" style="color: rgb(175,95,0)">\n</span><span style="color: rgb(175,0,0)">------------------------------------</span><span style="color: rgb(175,0,0)">&#39;</span>)
<span class="ansi-green-intense-fg ansi-bold">      5</span> <span style="color: rgb(0,135,0)">print</span>(h5_main)

<span class="ansi-red-fg">NameError</span>: name &#39;h5_file&#39; is not defined
</pre></div></div>
</div>
<section id="Get-some-basic-parameters-from-the-H5-file">
<h4>Get some basic parameters from the H5 file<a class="headerlink" href="#Get-some-basic-parameters-from-the-H5-file" title="Link to this heading">¶</a></h4>
<p>This information will be vital for futher analysis and visualization of the data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_pos_inds</span> <span class="o">=</span> <span class="n">h5_main</span><span class="o">.</span><span class="n">h5_pos_inds</span>
<span class="n">pos_dims</span> <span class="o">=</span> <span class="n">h5_main</span><span class="o">.</span><span class="n">pos_dim_sizes</span>
<span class="n">pos_labels</span> <span class="o">=</span> <span class="n">h5_main</span><span class="o">.</span><span class="n">pos_dim_labels</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pos_labels</span><span class="p">,</span> <span class="n">pos_dims</span><span class="p">)</span>

<span class="n">h5_meas_grp</span> <span class="o">=</span> <span class="n">h5_main</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>

<span class="n">parm_dict</span> <span class="o">=</span> <span class="n">sidpy</span><span class="o">.</span><span class="n">hdf</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">get_attributes</span><span class="p">(</span><span class="n">h5_meas_grp</span><span class="p">)</span>

<span class="n">expt_type</span> <span class="o">=</span> <span class="n">sidpy</span><span class="o">.</span><span class="n">hdf</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5_file</span><span class="p">,</span> <span class="s1">&#39;data_type&#39;</span><span class="p">)</span>

<span class="n">is_ckpfm</span> <span class="o">=</span> <span class="n">expt_type</span> <span class="o">==</span> <span class="s1">&#39;cKPFMData&#39;</span>
<span class="k">if</span> <span class="n">is_ckpfm</span><span class="p">:</span>
    <span class="n">num_write_steps</span> <span class="o">=</span> <span class="n">parm_dict</span><span class="p">[</span><span class="s1">&#39;VS_num_DC_write_steps&#39;</span><span class="p">]</span>
    <span class="n">num_read_steps</span> <span class="o">=</span> <span class="n">parm_dict</span><span class="p">[</span><span class="s1">&#39;VS_num_read_steps&#39;</span><span class="p">]</span>
    <span class="n">num_fields</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">if</span> <span class="n">expt_type</span> <span class="o">!=</span> <span class="s1">&#39;BELineData&#39;</span><span class="p">:</span>
    <span class="n">vs_mode</span> <span class="o">=</span> <span class="n">sidpy</span><span class="o">.</span><span class="n">hdf</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5_meas_grp</span><span class="p">,</span> <span class="s1">&#39;VS_mode&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">field_mode</span> <span class="o">=</span> <span class="n">sidpy</span><span class="o">.</span><span class="n">hdf</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5_meas_grp</span><span class="p">,</span> <span class="s1">&#39;VS_measure_in_field_loops&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;field mode could not be found. Setting to default value&#39;</span><span class="p">)</span>
        <span class="n">field_mode</span> <span class="o">=</span> <span class="s1">&#39;out-of-field&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">vs_cycle_frac</span> <span class="o">=</span> <span class="n">sidpy</span><span class="o">.</span><span class="n">hdf</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="n">h5_meas_grp</span><span class="p">,</span> <span class="s1">&#39;VS_cycle_fraction&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;VS cycle fraction could not be found. Setting to default value&#39;</span><span class="p">)</span>
        <span class="n">vs_cycle_frac</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[9], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> h5_pos_inds <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">h5_main</span><span style="color: rgb(98,98,98)">.</span>h5_pos_inds
<span class="ansi-green-intense-fg ansi-bold">      2</span> pos_dims <span style="color: rgb(98,98,98)">=</span> h5_main<span style="color: rgb(98,98,98)">.</span>pos_dim_sizes
<span class="ansi-green-intense-fg ansi-bold">      3</span> pos_labels <span style="color: rgb(98,98,98)">=</span> h5_main<span style="color: rgb(98,98,98)">.</span>pos_dim_labels

<span class="ansi-red-fg">NameError</span>: name &#39;h5_main&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Visualize-the-raw-data">
<h4>Visualize the raw data<a class="headerlink" href="#Visualize-the-raw-data" title="Link to this heading">¶</a></h4>
<p>Use the sliders below to visualize spatial maps (2D only for now), and spectrograms. For simplicity, all the spectroscopic dimensions such as frequency, excitation bias, cycle, field, etc. have been collapsed to a single slider.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">belib</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">be_viz_utils</span><span class="o">.</span><span class="n">jupyter_visualize_be_spectrograms</span><span class="p">(</span><span class="n">h5_main</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[10], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> fig <span style="color: rgb(98,98,98)">=</span> belib<span style="color: rgb(98,98,98)">.</span>viz<span style="color: rgb(98,98,98)">.</span>be_viz_utils<span style="color: rgb(98,98,98)">.</span>jupyter_visualize_be_spectrograms(<span class="ansi-yellow-bg">h5_main</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;h5_main&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Fit-the-Band-Excitation-(BE)-spectra">
<h4>Fit the Band Excitation (BE) spectra<a class="headerlink" href="#Fit-the-Band-Excitation-(BE)-spectra" title="Link to this heading">¶</a></h4>
<p>Fit each of the acquired spectra to a simple harmonic oscillator (SHO) model to extract the following information regarding the response: * Oscillation amplitude * Phase * Resonance frequency * Quality factor</p>
<p>By default, the cell below will take any previous result instead of re-computing the SHO fit</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sho_fit_points</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># The number of data points at each step to use when fitting</span>
<span class="n">sho_override</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Force recompute if True</span>

<span class="n">h5_sho_targ_grp</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">if</span> <span class="n">results_to_new_file</span><span class="p">:</span>
    <span class="n">h5_sho_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span>
                                <span class="n">h5_raw_file_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;_sho_fit.h5&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">SHO Fits will be written to:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">h5_sho_file_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">f_open_mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">h5_sho_file_path</span><span class="p">):</span>
        <span class="n">f_open_mode</span> <span class="o">=</span> <span class="s1">&#39;r+&#39;</span>
    <span class="n">h5_sho_file</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">h5_sho_file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">f_open_mode</span><span class="p">)</span>
    <span class="n">h5_sho_targ_grp</span> <span class="o">=</span> <span class="n">h5_sho_file</span>

<span class="n">sho_fitter</span> <span class="o">=</span> <span class="n">belib</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">BESHOfitter</span><span class="p">(</span><span class="n">h5_main</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="n">max_cores</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">h5_target_group</span><span class="o">=</span><span class="n">h5_sho_targ_grp</span><span class="p">)</span>
<span class="n">sho_fitter</span><span class="o">.</span><span class="n">set_up_guess</span><span class="p">(</span><span class="n">guess_func</span><span class="o">=</span><span class="n">belib</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">be_sho_fitter</span><span class="o">.</span><span class="n">SHOGuessFunc</span><span class="o">.</span><span class="n">complex_gaussian</span><span class="p">,</span>
                        <span class="n">num_points</span><span class="o">=</span><span class="n">sho_fit_points</span><span class="p">)</span>
<span class="n">h5_sho_guess</span> <span class="o">=</span> <span class="n">sho_fitter</span><span class="o">.</span><span class="n">do_guess</span><span class="p">(</span><span class="n">override</span><span class="o">=</span><span class="n">sho_override</span><span class="p">)</span>
<span class="n">sho_fitter</span><span class="o">.</span><span class="n">set_up_fit</span><span class="p">()</span>
<span class="n">h5_sho_fit</span> <span class="o">=</span> <span class="n">sho_fitter</span><span class="o">.</span><span class="n">do_fit</span><span class="p">(</span><span class="n">override</span><span class="o">=</span><span class="n">sho_override</span><span class="p">)</span>
<span class="n">h5_sho_grp</span> <span class="o">=</span> <span class="n">h5_sho_fit</span><span class="o">.</span><span class="n">parent</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[11], line 15</span>
<span class="ansi-green-intense-fg ansi-bold">     12</span>     h5_sho_file <span style="color: rgb(98,98,98)">=</span> h5py<span style="color: rgb(98,98,98)">.</span>File(h5_sho_file_path, mode<span style="color: rgb(98,98,98)">=</span>f_open_mode)
<span class="ansi-green-intense-fg ansi-bold">     13</span>     h5_sho_targ_grp <span style="color: rgb(98,98,98)">=</span> h5_sho_file
<span class="ansi-green-fg">---&gt; 15</span> sho_fitter <span style="color: rgb(98,98,98)">=</span> belib<span style="color: rgb(98,98,98)">.</span>analysis<span style="color: rgb(98,98,98)">.</span>BESHOfitter(<span class="ansi-yellow-bg">h5_main</span>, cores<span style="color: rgb(98,98,98)">=</span>max_cores, verbose<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">False</span>, h5_target_group<span style="color: rgb(98,98,98)">=</span>h5_sho_targ_grp)
<span class="ansi-green-intense-fg ansi-bold">     16</span> sho_fitter<span style="color: rgb(98,98,98)">.</span>set_up_guess(guess_func<span style="color: rgb(98,98,98)">=</span>belib<span style="color: rgb(98,98,98)">.</span>analysis<span style="color: rgb(98,98,98)">.</span>be_sho_fitter<span style="color: rgb(98,98,98)">.</span>SHOGuessFunc<span style="color: rgb(98,98,98)">.</span>complex_gaussian,
<span class="ansi-green-intense-fg ansi-bold">     17</span>                         num_points<span style="color: rgb(98,98,98)">=</span>sho_fit_points)
<span class="ansi-green-intense-fg ansi-bold">     18</span> h5_sho_guess <span style="color: rgb(98,98,98)">=</span> sho_fitter<span style="color: rgb(98,98,98)">.</span>do_guess(override<span style="color: rgb(98,98,98)">=</span>sho_override)

<span class="ansi-red-fg">NameError</span>: name &#39;h5_main&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Visualize-the-SHO-results">
<h4>Visualize the SHO results<a class="headerlink" href="#Visualize-the-SHO-results" title="Link to this heading">¶</a></h4>
<p>Here, we visualize the parameters for the SHO fits. BE-line (3D) data is visualized via simple spatial maps of the SHO parameters while more complex BEPS datasets (4+ dimensions) can be visualized using a simple interactive visualizer below.</p>
<p>You can choose to visualize the guesses for SHO function or the final fit values from the first line of the cell below.</p>
<p>Use the sliders below to inspect the BE response at any given location.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_sho_spec_inds</span> <span class="o">=</span> <span class="n">h5_sho_fit</span><span class="o">.</span><span class="n">h5_spec_inds</span>
<span class="n">sho_spec_labels</span> <span class="o">=</span> <span class="n">h5_sho_fit</span><span class="o">.</span><span class="n">spec_dim_labels</span>

<span class="k">if</span> <span class="n">is_ckpfm</span><span class="p">:</span>
    <span class="c1"># It turns out that the read voltage index starts from 1 instead of 0</span>
    <span class="c1"># Also the VDC indices are NOT repeating. They are just rising monotonically</span>
    <span class="n">write_volt_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">sho_spec_labels</span> <span class="o">==</span> <span class="s1">&#39;write_bias&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">read_volt_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">sho_spec_labels</span> <span class="o">==</span> <span class="s1">&#39;read_bias&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">h5_sho_spec_inds</span><span class="p">[</span><span class="n">read_volt_index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="n">h5_sho_spec_inds</span><span class="p">[</span><span class="n">write_volt_index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_write_steps</span><span class="p">),</span> <span class="n">num_fields</span><span class="p">),</span> <span class="n">num_read_steps</span><span class="p">)</span>

<span class="p">(</span><span class="n">Nd_mat</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">nd_labels</span><span class="p">)</span> <span class="o">=</span> <span class="n">usid</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">reshape_to_n_dims</span><span class="p">(</span><span class="n">h5_sho_fit</span><span class="p">,</span> <span class="n">get_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reshape Success: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">success</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">nd_labels</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Nd_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[12], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> h5_sho_spec_inds <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">h5_sho_fit</span><span style="color: rgb(98,98,98)">.</span>h5_spec_inds
<span class="ansi-green-intense-fg ansi-bold">      2</span> sho_spec_labels <span style="color: rgb(98,98,98)">=</span> h5_sho_fit<span style="color: rgb(98,98,98)">.</span>spec_dim_labels
<span class="ansi-green-intense-fg ansi-bold">      4</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> is_ckpfm:
<span class="ansi-green-intense-fg ansi-bold">      5</span>     <span style="color: rgb(95,135,135)"># It turns out that the read voltage index starts from 1 instead of 0</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     <span style="color: rgb(95,135,135)"># Also the VDC indices are NOT repeating. They are just rising monotonically</span>

<span class="ansi-red-fg">NameError</span>: name &#39;h5_sho_fit&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">use_sho_guess</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">use_static_viz_func</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">if</span> <span class="n">use_sho_guess</span><span class="p">:</span>
    <span class="n">sho_dset</span> <span class="o">=</span> <span class="n">h5_sho_guess</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">sho_dset</span> <span class="o">=</span> <span class="n">h5_sho_fit</span>

<span class="k">if</span> <span class="n">expt_type</span> <span class="o">==</span> <span class="s1">&#39;BELineData&#39;</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_dims</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">use_static_viz_func</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">step_chan</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">vs_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;AC modulation mode with time reversal&#39;</span><span class="p">,</span>
                                                      <span class="s1">&#39;DC modulation mode&#39;</span><span class="p">]:</span>
        <span class="n">use_static_viz_func</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">vs_mode</span> <span class="o">==</span> <span class="s1">&#39;DC modulation mode&#39;</span><span class="p">:</span>
            <span class="n">step_chan</span> <span class="o">=</span> <span class="s1">&#39;DC_Offset&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">step_chan</span> <span class="o">=</span> <span class="s1">&#39;AC_Amplitude&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">use_static_viz_func</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># use interactive visualization</span>
        <span class="n">belib</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">be_viz_utils</span><span class="o">.</span><span class="n">jupyter_visualize_beps_sho</span><span class="p">(</span><span class="n">sho_dset</span><span class="p">,</span> <span class="n">step_chan</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There was a problem with the interactive visualizer&#39;</span><span class="p">)</span>
        <span class="n">use_static_viz_func</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">chan_grp</span> <span class="o">=</span> <span class="n">h5_main</span><span class="o">.</span><span class="n">parent</span>
    <span class="n">meas_grp</span> <span class="o">=</span> <span class="n">chan_grp</span><span class="o">.</span><span class="n">parent</span>
    <span class="c1"># show plots of SHO results vs. applied bias</span>
    <span class="n">figs</span> <span class="o">=</span> <span class="n">belib</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">be_viz_utils</span><span class="o">.</span><span class="n">visualize_sho_results</span><span class="p">(</span><span class="n">sho_dset</span><span class="p">,</span> <span class="n">show_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_plots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                     <span class="n">expt_type</span><span class="o">=</span><span class="n">expt_type</span><span class="p">,</span> <span class="n">meas_type</span><span class="o">=</span><span class="n">vs_mode</span><span class="p">,</span>
                                                     <span class="n">field_mode</span><span class="o">=</span><span class="n">field_mode</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[13], line 7</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     sho_dset <span style="color: rgb(98,98,98)">=</span> h5_sho_guess
<span class="ansi-green-intense-fg ansi-bold">      6</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">----&gt; 7</span>     sho_dset <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">h5_sho_fit</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> expt_type <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">BELineData</span><span style="color: rgb(175,0,0)">&#39;</span> <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> <span style="color: rgb(0,135,0)">len</span>(pos_dims) <span style="color: rgb(98,98,98)">!=</span> <span style="color: rgb(98,98,98)">2</span>:
<span class="ansi-green-intense-fg ansi-bold">     10</span>     use_static_viz_func <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(0,135,0)">True</span>

<span class="ansi-red-fg">NameError</span>: name &#39;h5_sho_fit&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Fit-loops-to-a-function">
<h4>Fit loops to a function<a class="headerlink" href="#Fit-loops-to-a-function" title="Link to this heading">¶</a></h4>
<p>This is applicable only to DC voltage spectroscopy datasets from BEPS. The PFM hysteresis loops in this dataset will be projected to maximize the loop area and then fitted to a function.</p>
<p>Note: This computation generally takes a while for reasonably sized datasets.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Do the Loop Fitting on the SHO Fit dataset</span>
<span class="n">loop_success</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">h5_loop_group</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">if</span> <span class="n">results_to_new_file</span><span class="p">:</span>
    <span class="n">h5_loop_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span>
                                     <span class="n">h5_raw_file_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;_loop_fit.h5&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Loop Fits will be written to:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">h5_loop_file_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">f_open_mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">h5_loop_file_path</span><span class="p">):</span>
        <span class="n">f_open_mode</span> <span class="o">=</span> <span class="s1">&#39;r+&#39;</span>
    <span class="n">h5_loop_file</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">h5_loop_file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">f_open_mode</span><span class="p">)</span>
    <span class="n">h5_loop_group</span> <span class="o">=</span> <span class="n">h5_loop_file</span>

<span class="n">loop_fitter</span> <span class="o">=</span> <span class="n">belib</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">BELoopFitter</span><span class="p">(</span><span class="n">h5_sho_fit</span><span class="p">,</span> <span class="n">expt_type</span><span class="p">,</span> <span class="n">vs_mode</span><span class="p">,</span> <span class="n">vs_cycle_frac</span><span class="p">,</span>
                                       <span class="n">cores</span><span class="o">=</span><span class="n">max_cores</span><span class="p">,</span> <span class="n">h5_target_group</span><span class="o">=</span><span class="n">h5_loop_group</span><span class="p">,</span>
                                       <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">loop_fitter</span><span class="o">.</span><span class="n">set_up_guess</span><span class="p">()</span>
<span class="n">h5_loop_guess</span> <span class="o">=</span> <span class="n">loop_fitter</span><span class="o">.</span><span class="n">do_guess</span><span class="p">(</span><span class="n">override</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Calling explicitely here since Fitter won&#39;t do it automatically</span>
<span class="n">h5_guess_loop_parms</span> <span class="o">=</span> <span class="n">loop_fitter</span><span class="o">.</span><span class="n">extract_loop_parameters</span><span class="p">(</span><span class="n">h5_loop_guess</span><span class="p">)</span>

<span class="n">loop_fitter</span><span class="o">.</span><span class="n">set_up_fit</span><span class="p">()</span>
<span class="n">h5_loop_fit</span> <span class="o">=</span> <span class="n">loop_fitter</span><span class="o">.</span><span class="n">do_fit</span><span class="p">(</span><span class="n">override</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">h5_loop_group</span> <span class="o">=</span> <span class="n">h5_loop_fit</span><span class="o">.</span><span class="n">parent</span>
<span class="n">loop_success</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[14], line 15</span>
<span class="ansi-green-intense-fg ansi-bold">     12</span>     h5_loop_file <span style="color: rgb(98,98,98)">=</span> h5py<span style="color: rgb(98,98,98)">.</span>File(h5_loop_file_path, mode<span style="color: rgb(98,98,98)">=</span>f_open_mode)
<span class="ansi-green-intense-fg ansi-bold">     13</span>     h5_loop_group <span style="color: rgb(98,98,98)">=</span> h5_loop_file
<span class="ansi-green-fg">---&gt; 15</span> loop_fitter <span style="color: rgb(98,98,98)">=</span> belib<span style="color: rgb(98,98,98)">.</span>analysis<span style="color: rgb(98,98,98)">.</span>BELoopFitter(<span class="ansi-yellow-bg">h5_sho_fit</span>, expt_type, vs_mode, vs_cycle_frac,
<span class="ansi-green-intense-fg ansi-bold">     16</span>                                        cores<span style="color: rgb(98,98,98)">=</span>max_cores, h5_target_group<span style="color: rgb(98,98,98)">=</span>h5_loop_group,
<span class="ansi-green-intense-fg ansi-bold">     17</span>                                        verbose<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)
<span class="ansi-green-intense-fg ansi-bold">     18</span> loop_fitter<span style="color: rgb(98,98,98)">.</span>set_up_guess()
<span class="ansi-green-intense-fg ansi-bold">     19</span> h5_loop_guess <span style="color: rgb(98,98,98)">=</span> loop_fitter<span style="color: rgb(98,98,98)">.</span>do_guess(override<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;h5_sho_fit&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Prepare-datasets-for-visualization">
<h4>Prepare datasets for visualization<a class="headerlink" href="#Prepare-datasets-for-visualization" title="Link to this heading">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare some variables for plotting loops fits and guesses</span>
<span class="c1"># Plot the Loop Guess and Fit Results</span>
<span class="k">if</span> <span class="n">loop_success</span><span class="p">:</span>
    <span class="n">h5_projected_loops</span> <span class="o">=</span> <span class="n">usid</span><span class="o">.</span><span class="n">USIDataset</span><span class="p">(</span><span class="n">h5_loop_guess</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="s1">&#39;Projected_Loops&#39;</span><span class="p">])</span>
    <span class="n">h5_proj_spec_inds</span> <span class="o">=</span> <span class="n">h5_projected_loops</span><span class="o">.</span><span class="n">h5_spec_inds</span>
    <span class="n">h5_proj_spec_vals</span> <span class="o">=</span> <span class="n">h5_projected_loops</span><span class="o">.</span><span class="n">h5_spec_vals</span>

    <span class="c1"># reshape the vdc_vec into DC_step by Loop</span>
    <span class="n">sort_order</span> <span class="o">=</span> <span class="n">usid</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">get_sort_order</span><span class="p">(</span><span class="n">h5_proj_spec_inds</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">usid</span><span class="o">.</span><span class="n">hdf_utils</span><span class="o">.</span><span class="n">get_dimensionality</span><span class="p">(</span><span class="n">h5_proj_spec_inds</span><span class="p">[()],</span>
                                           <span class="n">sort_order</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">vdc_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">h5_proj_spec_vals</span><span class="p">[</span><span class="n">h5_proj_spec_vals</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;DC_Offset&#39;</span><span class="p">]],</span> <span class="n">dims</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="c1">#Also reshape the projected loops to Positions-DC_Step-Loop</span>
    <span class="c1"># Also reshape the projected loops to Positions-DC_Step-Loop</span>
    <span class="n">proj_nd</span> <span class="o">=</span> <span class="n">h5_projected_loops</span><span class="o">.</span><span class="n">get_n_dim_form</span><span class="p">()</span>
    <span class="n">proj_3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">proj_nd</span><span class="p">,</span> <span class="p">[</span><span class="n">h5_projected_loops</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">proj_nd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</section>
<section id="Visualize-Loop-fits">
<h4>Visualize Loop fits<a class="headerlink" href="#Visualize-Loop-fits" title="Link to this heading">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">use_static_plots</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">loop_success</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">use_static_plots</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">belib</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">be_viz_utils</span><span class="o">.</span><span class="n">jupyter_visualize_beps_loops</span><span class="p">(</span><span class="n">h5_projected_loops</span><span class="p">,</span> <span class="n">h5_loop_guess</span><span class="p">,</span> <span class="n">h5_loop_fit</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There was a problem with the interactive visualizer&#39;</span><span class="p">)</span>
            <span class="n">use_static_plots</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">use_static_plots</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">iloop</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h5_loop_guess</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">belib</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">be_viz_utils</span><span class="o">.</span><span class="n">plot_loop_guess_fit</span><span class="p">(</span><span class="n">vdc_vec</span><span class="p">[:,</span> <span class="n">iloop</span><span class="p">],</span> <span class="n">proj_3d</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">iloop</span><span class="p">],</span>
                                          <span class="n">h5_loop_guess</span><span class="p">[:,</span> <span class="n">iloop</span><span class="p">],</span> <span class="n">h5_loop_fit</span><span class="p">[:,</span> <span class="n">iloop</span><span class="p">],</span>
                                          <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Loop </span><span class="si">{}</span><span class="s1"> - All Positions&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">iloop</span><span class="p">))</span>
</pre></div>
</div>
</div>
</section>
<section id="Loop-Parameters">
<h4>Loop Parameters<a class="headerlink" href="#Loop-Parameters" title="Link to this heading">¶</a></h4>
<p>We will now load the loop parameters caluculated from the fit and plot them.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_loop_parameters</span> <span class="o">=</span> <span class="n">h5_loop_group</span><span class="p">[</span><span class="s1">&#39;Fit_Loop_Parameters&#39;</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">belib</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">be_viz_utils</span><span class="o">.</span><span class="n">jupyter_visualize_parameter_maps</span><span class="p">(</span><span class="n">h5_loop_parameters</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[17], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> h5_loop_parameters <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">h5_loop_group</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">Fit_Loop_Parameters</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg">]</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> fig <span style="color: rgb(98,98,98)">=</span> belib<span style="color: rgb(98,98,98)">.</span>viz<span style="color: rgb(98,98,98)">.</span>be_viz_utils<span style="color: rgb(98,98,98)">.</span>jupyter_visualize_parameter_maps(h5_loop_parameters)

<span class="ansi-red-fg">TypeError</span>: &#39;NoneType&#39; object is not subscriptable
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">map_parm</span> <span class="o">=</span> <span class="s1">&#39;Work of Switching&#39;</span>
<span class="n">plot_cycle</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">plot_position</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pos_dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos_dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
<span class="n">plot_bias_step</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">belib</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">be_viz_utils</span><span class="o">.</span><span class="n">plot_loop_sho_raw_comparison</span><span class="p">(</span><span class="n">h5_loop_parameters</span><span class="p">,</span> <span class="n">h5_sho_grp</span><span class="p">,</span> <span class="n">h5_main</span><span class="p">,</span>
                                                       <span class="n">selected_loop_parm</span><span class="o">=</span><span class="n">map_parm</span><span class="p">,</span>
                                                       <span class="n">selected_loop_cycle</span><span class="o">=</span><span class="n">plot_cycle</span><span class="p">,</span>
                                                       <span class="n">selected_loop_pos</span><span class="o">=</span><span class="n">plot_position</span><span class="p">,</span>
                                                       <span class="n">selected_step</span><span class="o">=</span><span class="n">plot_bias_step</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[18], line 3</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> map_parm <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">Work of Switching</span><span style="color: rgb(175,0,0)">&#39;</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> plot_cycle <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(98,98,98)">0</span>
<span class="ansi-green-fg">----&gt; 3</span> plot_position <span style="color: rgb(98,98,98)">=</span> (<span style="color: rgb(0,135,0)">int</span>(<span class="ansi-yellow-bg">pos_dims</span>[<span style="color: rgb(98,98,98)">0</span>]<span style="color: rgb(98,98,98)">/</span><span style="color: rgb(98,98,98)">2</span>), <span style="color: rgb(0,135,0)">int</span>(pos_dims[<span style="color: rgb(98,98,98)">1</span>]<span style="color: rgb(98,98,98)">/</span><span style="color: rgb(98,98,98)">2</span>))
<span class="ansi-green-intense-fg ansi-bold">      4</span> plot_bias_step <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(98,98,98)">0</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> fig <span style="color: rgb(98,98,98)">=</span> belib<span style="color: rgb(98,98,98)">.</span>viz<span style="color: rgb(98,98,98)">.</span>be_viz_utils<span style="color: rgb(98,98,98)">.</span>plot_loop_sho_raw_comparison(h5_loop_parameters, h5_sho_grp, h5_main,
<span class="ansi-green-intense-fg ansi-bold">      7</span>                                                        selected_loop_parm<span style="color: rgb(98,98,98)">=</span>map_parm,
<span class="ansi-green-intense-fg ansi-bold">      8</span>                                                        selected_loop_cycle<span style="color: rgb(98,98,98)">=</span>plot_cycle,
<span class="ansi-green-intense-fg ansi-bold">      9</span>                                                        selected_loop_pos<span style="color: rgb(98,98,98)">=</span>plot_position,
<span class="ansi-green-intense-fg ansi-bold">     10</span>                                                        selected_step<span style="color: rgb(98,98,98)">=</span>plot_bias_step)

<span class="ansi-red-fg">NameError</span>: name &#39;pos_dims&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Save-and-close">
<h4>Save and close<a class="headerlink" href="#Save-and-close" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Save the .h5 file that we are working on by closing it.</p></li>
<li><p>Also, consider exporting this notebook as a notebook or an html file. To do this, go to File &gt;&gt; Download as &gt;&gt; HTML</p></li>
<li><p>Finally consider saving this notebook if necessary</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h5_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">if</span> <span class="n">results_to_new_file</span><span class="p">:</span>
    <span class="n">h5_sho_fit</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">h5_loop_fit</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[19], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span class="ansi-yellow-bg">h5_file</span><span style="color: rgb(98,98,98)">.</span>close()
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> results_to_new_file:
<span class="ansi-green-intense-fg ansi-bold">      3</span>     h5_sho_fit<span style="color: rgb(98,98,98)">.</span>file<span style="color: rgb(98,98,98)">.</span>close()

<span class="ansi-red-fg">NameError</span>: name &#39;h5_file&#39; is not defined
</pre></div></div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Band Excitation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="BE_Processing_cKPFM.html" class="btn btn-neutral float-right" title="Band Excitation data procesing using pycroscopy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Pycroscopy contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>